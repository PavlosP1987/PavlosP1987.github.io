<!DOCTYPE html>
<html>
<head>
    <title>Chess Board FEN Extractor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .upload-area { 
            border: 3px dashed #ccc; 
            padding: 40px; 
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
        }
        #preview { max-width: 100%; margin: 20px 0; }
        #result { 
            background: #f5f5f5; 
            padding: 20px; 
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chess Board FEN Extractor</h1>
        
        <div class="upload-area" id="dropArea">
            <p>Drag & drop chessboard image here</p>
            <p>or click to select</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
        
        <div id="previewContainer" style="display: none;">
            <h3>Preview:</h3>
            <img id="preview" src="" alt="Preview">
        </div>
        
        <button onclick="processImage()" id="processBtn" disabled>Extract FEN</button>
        
        <div id="resultContainer" style="display: none;">
            <h3>FEN Notation:</h3>
            <div id="result"></div>
            <button onclick="copyFEN()">Copy FEN</button>
            <button onclick="openLichess()">Open in Lichess</button>
        </div>
    </div>
    
    <script>
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('dropArea').addEventListener('click', () => document.getElementById('fileInput').click());
        
        let currentImage = null;
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImage = e.target.result;
                document.getElementById('preview').src = currentImage;
                document.getElementById('previewContainer').style.display = 'block';
                document.getElementById('processBtn').disabled = false;
            };
            reader.readAsDataURL(file);
        }
        
        async function processImage() {
            if (!currentImage) return;
            
            // Convert to blob
            const blob = await fetch(currentImage).then(r => r.blob());
            const formData = new FormData();
            formData.append('image', blob, 'chessboard.jpg');
            
            document.getElementById('result').innerHTML = 'Processing...';
            document.getElementById('resultContainer').style.display = 'block';
            
            // Send to processing endpoint
            try {
                // You need to implement this endpoint
                const response = await fetch('/process-chessboard', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('result').innerHTML = result.fen;
                } else {
                    document.getElementById('result').innerHTML = 'Error: ' + result.error;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 'Error: ' + error.message;
            }
        }
        
        function copyFEN() {
            const fen = document.getElementById('result').innerText;
            navigator.clipboard.writeText(fen);
            alert('FEN copied to clipboard!');
        }
        
        function openLichess() {
            const fen = encodeURIComponent(document.getElementById('result').innerText);
            window.open(`https://lichess.org/editor/${fen}`, '_blank');
        }
    </script>
</body>
</html>
